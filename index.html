<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Thu Chi 12 Th√°ng</title>

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    background:#0f172a;
    color:white;
}

/* LOGIN */
.login-screen{
    position:fixed;
    inset:0;
    background:#0f172a;
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    z-index:999;
}
.login-box{
    background:#1e293b;
    padding:30px;
    border-radius:20px;
    width:90%;
    max-width:350px;
    text-align:center;
}
.login-box input{
    width:100%;
    padding:14px;
    border-radius:12px;
    border:none;
    margin:15px 0;
}
.login-box button{
    width:100%;
    padding:14px;
    border:none;
    border-radius:12px;
    background:#22c55e;
    color:white;
    font-weight:bold;
}

/* MAIN */
.header{
    padding:20px;
    text-align:center;
    font-size:22px;
    font-weight:700;
    background:#111827;
}
.container{padding:15px}
.card{
    background:#1e293b;
    border-radius:18px;
    padding:16px;
    margin-bottom:16px;
}
.month{
    font-weight:600;
    margin-bottom:10px;
}
.row{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:12px;
}
.row input{
    padding:14px;
    border-radius:14px;
    border:none;
    font-size:16px;
    font-weight:bold;
}
.thu{background:#052e1a;color:#22c55e;}
.chi{background:#3b0a0a;color:#ef4444;}

.result{
    margin-top:10px;
    font-weight:bold;
    text-decoration:underline;
}
.green{color:#22c55e}
.red{color:#ef4444}
.gray{color:#cbd5e1}

.year-box{
    background:#111827;
    padding:18px;
    border-radius:18px;
    margin-top:20px;
    font-weight:bold;
    text-decoration:underline;
}

/* POPUP */
#dailyPopup{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.6);
    justify-content:center;
    align-items:center;
    z-index:9999;
}
.popup-box{
    background:#1e293b;
    padding:20px;
    border-radius:16px;
    width:90%;
    max-width:350px;
}
.popup-box input{
    width:100%;
    padding:10px;
    margin-bottom:10px;
    border-radius:10px;
    border:none;
}
.popup-box button{
    width:100%;
    padding:10px;
    border:none;
    border-radius:10px;
    margin-top:5px;
    font-weight:bold;
}
.save-btn{background:#22c55e;color:white;}
.close-btn{background:#ef4444;color:white;}

.daily-item{
    font-size:13px;
    margin-top:5px;
    color:#cbd5e1;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="login-screen" id="loginScreen">
    <div class="login-box">
        <h2>üîê Nh·∫≠p m·∫≠t kh·∫©u</h2>
        <input type="password" id="password" placeholder="M·∫≠t kh·∫©u">
        <button onclick="checkLogin()">M·ªü</button>
        <div id="error" style="color:#ef4444;"></div>
    </div>
</div>

<!-- APP -->
<div id="appContent" style="display:none;">
    <div class="header">üí∞ T·ªïng Thu Chi 12 Th√°ng</div>
    <div class="container" id="app"></div>
</div>

<!-- POPUP -->
<div id="dailyPopup">
    <div class="popup-box">
        <h3>Nh·∫≠p thu chi ng√†y</h3>
        <input type="date" id="dailyDate">
        <input type="text" inputmode="numeric" id="dailyThu" placeholder="Thu">
        <input type="text" inputmode="numeric" id="dailyChi" placeholder="Chi">
        <button class="save-btn" onclick="saveDaily()">L∆∞u</button>
        <button class="close-btn" onclick="closeDaily()">ƒê√≥ng</button>
    </div>
</div>

<script>
const APP_PASSWORD="123456";
let currentMonth=0;
let dailyData=JSON.parse(localStorage.getItem("dailyData"))||{};

function checkLogin(){
    if(document.getElementById("password").value===APP_PASSWORD){
        localStorage.setItem("loggedIn","yes");
        openApp();
    }else{
        document.getElementById("error").innerText="Sai m·∫≠t kh·∫©u!";
    }
}

function openApp(){
    document.getElementById("loginScreen").style.display="none";
    document.getElementById("appContent").style.display="block";
}

if(localStorage.getItem("loggedIn")==="yes") openApp();

/* T·∫†O 12 TH√ÅNG */
const app=document.getElementById("app");

for(let i=1;i<=12;i++){
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
    <div class="month">
        Th√°ng ${i}
        <button onclick="openDaily(${i})"
        style="float:right;background:#334155;border:none;color:white;padding:4px 8px;border-radius:8px;font-size:12px;">
        + Ng√†y</button>
    </div>
    <div class="row">
        <input type="text" inputmode="numeric" class="thu" id="thu${i}" placeholder="Thu">
        <input type="text" inputmode="numeric" class="chi" id="chi${i}" placeholder="Chi">
    </div>
    <div class="result gray" id="conlai${i}">‚ûñ C√≤n l·∫°i: 0 ƒë</div>
    <div id="dailyBox${i}"></div>
    `;
    app.appendChild(card);
}

const yearBox=document.createElement("div");
yearBox.className="year-box gray";
yearBox.id="yearResult";
app.appendChild(yearBox);

function cleanNumber(v){return v.replace(/\D/g,'');}
function formatMoney(v){return v?Number(v).toLocaleString("vi-VN"):"";}
function getNumber(id){return Number(cleanNumber(document.getElementById(id).value))||0;}

function update(){
    let totalThu=0,totalChi=0;

    for(let i=1;i<=12;i++){
        let thu=getNumber("thu"+i);
        let chi=getNumber("chi"+i);
        totalThu+=thu;
        totalChi+=chi;

        let conlai=thu-chi;
        let result=document.getElementById("conlai"+i);

        let icon="‚ûñ",color="gray";
        if(conlai>0){icon="‚¨ÜÔ∏è";color="green";}
        if(conlai<0){icon="‚¨áÔ∏è";color="red";}

        result.className="result "+color;
        result.innerHTML=`${icon} C√≤n l·∫°i: ${conlai.toLocaleString("vi-VN")} ƒë`;
    }

    let nam=totalThu-totalChi;
    let icon="‚ûñ",color="gray";
    if(nam>0){icon="‚¨ÜÔ∏è";color="green";}
    if(nam<0){icon="‚¨áÔ∏è";color="red";}

    yearBox.className="year-box "+color;
    yearBox.innerHTML=`
    üíµ T·ªïng thu nƒÉm: ${totalThu.toLocaleString("vi-VN")} ƒë <br>
    üí∏ T·ªïng chi nƒÉm: ${totalChi.toLocaleString("vi-VN")} ƒë <br>
    ${icon} C√≤n l·∫°i nƒÉm: ${nam.toLocaleString("vi-VN")} ƒë
    `;

    localStorage.setItem("data",JSON.stringify(getData()));
}

function getData(){
    let data=[];
    for(let i=1;i<=12;i++){
        data.push({thu:getNumber("thu"+i),chi:getNumber("chi"+i)});
    }
    return data;
}

function loadData(){
    let data=JSON.parse(localStorage.getItem("data"));
    if(!data)return;
    data.forEach((d,i)=>{
        document.getElementById("thu"+(i+1)).value=formatMoney(d.thu);
        document.getElementById("chi"+(i+1)).value=formatMoney(d.chi);
    });
    update();
}

document.addEventListener("input",function(e){
    if(e.target.classList.contains("thu")||
       e.target.classList.contains("chi")){
        e.target.value=formatMoney(cleanNumber(e.target.value));
        update();
    }
});

/* DAILY */
function openDaily(month){
    currentMonth=month;
    document.getElementById("dailyPopup").style.display="flex";
}
function closeDaily(){
    document.getElementById("dailyPopup").style.display="none";
}

function saveDaily(){
    let date=document.getElementById("dailyDate").value;
    let thu=Number(cleanNumber(document.getElementById("dailyThu").value))||0;
    let chi=Number(cleanNumber(document.getElementById("dailyChi").value))||0;

    if(!dailyData[currentMonth]) dailyData[currentMonth]=[];
    dailyData[currentMonth].push({date,thu,chi});

    localStorage.setItem("dailyData",JSON.stringify(dailyData));

    updateMonthFromDaily(currentMonth);
    showDailyList(currentMonth);
    closeDaily();
}

function updateMonthFromDaily(month){
    let list=dailyData[month]||[];
    let totalThu=0,totalChi=0;
    list.forEach(d=>{
        totalThu+=d.thu;
        totalChi+=d.chi;
    });

    document.getElementById("thu"+month).value=formatMoney(totalThu);
    document.getElementById("chi"+month).value=formatMoney(totalChi);
    update();
}

function showDailyList(month){
    let box=document.getElementById("dailyBox"+month);
    box.innerHTML="";
    let list=dailyData[month]||[];
    list.forEach(d=>{
        box.innerHTML+=`
        <div class="daily-item">
        üìÖ ${d.date} | +${d.thu.toLocaleString("vi-VN")} ƒë | -${d.chi.toLocaleString("vi-VN")} ƒë
        </div>`;
    });
}

for(let i=1;i<=12;i++){
    showDailyList(i);
    updateMonthFromDaily(i);
}

loadData();
</script>

</body>
</html>